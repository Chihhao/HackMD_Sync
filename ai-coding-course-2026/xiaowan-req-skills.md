# AI 小旺功能需求：先進技能系統 (Advanced Skill System) 實作建議書

## 1. 背景與目標
目前的「系統提示詞」僅能提供靜態的角色設定。本需求旨在實作一套「先進技能系統」，讓 AI 小旺能直接執行包含**數據知識庫**與**邏輯腳本**的專業技能包（如 `ui-ux-pro-max-skill`），實現「無腦安裝、專家級輸出」的目標。

## 2. 技能包 (Skill Bundle) 定義
一個先進技能包不只是提示詞，而是一個完整的專家系統，其結構包含：
- **`manifest.json`**: 技能元數據與 UI 定義（按鈕、輸入框、渲染需求）。
- **`prompt.md`**: 核心 System Prompt，定義 AI 的行為與輸出格式契約。
- **`logic/`**: 包含 Python (`.py`) 或 JavaScript 腳本，用於執行複雜的檢索或推理邏輯。
- **`knowledge/`**: 存放 CSV、JSON 或 Markdown 格式的專業知識庫。

## 3. 核心技術架構

### 3.1 技能執行環境 (Skill Runtime)
為了達成「無腦安裝」且不需手動轉譯邏輯，系統需具備執行原始腳本的能力：
- **Python 引擎 (Pyodide)**: 在瀏覽器中整合 WebAssembly 版的 Python 環境，直接執行技能包中的 `.py` 搜尋或推理腳本。
- **數據掛載**: 技能包中的 CSV 數據將載入至瀏覽器記憶體，並透過輕量級搜尋引擎（如 `Fuse.js`）提供給腳本調用。

### 3.2 動態 UI 注入 (UI Injection)
前端根據 `manifest.json` 的定義，動態擴充小旺的介面：
- **功能按鈕**: 在對話框工具列自動產生「生成設計系統」、「檢查暫存器」等專屬按鈕。
- **參數輸入**: 若技能需要特定參數（如「專案類型」），自動渲染對應的下拉選單或輸入框。

### 3.3 渲染攔截與組件對接
- **格式契約**: 技能提示詞會要求 AI 輸出特定標籤（如 ` ```design-system `）。
- **組件喚醒**: 前端攔截器偵測到標籤後，自動呼叫預先實作的「高級渲染組件」（如圖表、顏色預覽、Bit 欄位圖），將文字轉化為視覺化互動內容。

## 4. 實作策略：預裝模式 (Pre-installed Registry)
為了確保穩定性與安全性，系統採用「開發者預裝」機制：
- **技能註冊表**: 由開發者在原始碼中維護 `SkillRegistry.ts`，定義啟用的技能及其 GitHub 來源路徑。
- **自動同步**: 系統在建置階段自動從指定 GitHub 倉庫抓取最新內容並打包。
- **使用者體驗**: 使用者只需從「專家選單」中點選，無需自行尋找網址或匯入檔案。

## 5. 邏輯流程

1. **載入**: 小旺啟動時，根據註冊表載入預裝技能的 `manifest` 與數據。
2. **啟用**: 使用者切換至特定技能（如 UI/UX 專家）。
3. **前置處理 (Pre-process)**: 
   - 使用者輸入問題。
   - 小旺觸發技能內的 Python 腳本（透過 Pyodide）檢索本地知識庫。
   - 腳本回傳精確的參考數據。
4. **發送**: 將「參考數據 + 核心提示詞 + 使用者問題」組合成最終 Prompt 送往 LLM。
5. **後置渲染 (Post-render)**: 攔截 AI 回傳的特殊格式，渲染為視覺化組件。

## 6. 針對 TE 與專業領域的優化

- **TE 暫存器專家**: 預裝包含數千筆暫存器定義的 CSV，讓 AI 能精準解釋硬體位址。
- **UI/UX 專家**: 整合 `ui-ux-pro-max-skill` 的推理規則，自動產出符合美學的設計規範。
- **架構分析師**: 預裝 Mermaid 渲染引擎，將邏輯自動轉化為流程圖。

## 7. 推薦工具清單

| 功能 | 推薦技術/函式庫 | 說明 |
| :--- | :--- | :--- |
| **Python Runtime** | Pyodide | 在瀏覽器執行原始 Python 邏輯。 |
| **本地搜尋** | Fuse.js / FlexSearch | 快速檢索技能包中的 CSV 數據。 |
| **UI 動態渲染** | React Dynamic Components | 根據 JSON 配置動態產生按鈕與表單。 |
| **圖表渲染** | Mermaid.js / ECharts | 支援技能包要求的視覺化輸出。 |

## 8. 里程碑規劃

### M1: 技能容器基礎建設
- [ ] 實作 `SkillRegistry` 機制與靜態資源載入流程。
- [ ] 整合 Pyodide，驗證在前端執行簡單 Python 腳本的能力。

### M2: 動態 UI 與提示詞注入
- [ ] 實作根據 `manifest.json` 自動產生介面按鈕的功能。
- [ ] 實作「檢索 -> 注入 -> 發送」的代理工作流 (Agentic Workflow)。

### M3: 高級渲染與專家技能整合
- [ ] 實作 Markdown 標籤攔截器與自定義組件渲染。
- [ ] 正式整合 `ui-ux-pro-max-skill` 並進行端到端測試。

## 9. 潛在挑戰
- **Pyodide 載入效能**: Python 環境較大，需實作延遲載入 (Lazy Loading) 以免影響首頁開啟速度。
- **數據同步**: 確保本地知識庫與 GitHub 來源的一致性。
- **記憶體管理**: 多個技能同時掛載大量 CSV 數據時的瀏覽器記憶體佔用監控。
